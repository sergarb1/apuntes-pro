<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Logistics Command Center | Elite Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800;900&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { 
            margin: 0; 
            background: #020617; 
            font-family: 'Outfit', sans-serif; 
            overflow: hidden; 
            touch-action: none; 
            position: fixed; 
            width: 100%; 
            height: 100%; 
            color: white;
        }
        #game-container { 
            width: 100%; 
            height: 100%; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
        }
        .modal-blur { 
            background: rgba(2, 6, 23, 0.85); 
            backdrop-filter: blur(20px); 
            display: none; 
            z-index: 200; 
            position: fixed; 
            inset: 0; 
        }
        canvas { 
            max-width: 100%; 
            max-height: 100%; 
            object-fit: contain;
        }
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .progress-bar-fill { transition: width 0.4s ease-out; }
    </style>
</head>
<body class="antialiased select-none">

    <!-- PANTALLA DE INICIO -->
    <div id="intro-screen" class="fixed inset-0 z-[300] flex items-center justify-center p-4 bg-[#020617]">
        <div class="max-w-lg w-full glass-panel rounded-[3rem] p-10 text-center relative overflow-hidden border border-white/5 shadow-2xl">
            <div class="w-24 h-24 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-xl">
                <i data-lucide="package" class="text-white w-12 h-12"></i>
            </div>
            <h1 class="text-4xl font-black text-white mb-2 italic uppercase">LOGISTICS <span class="text-blue-400">MASTER</span></h1>
            <p class="text-slate-400 text-xs font-bold uppercase tracking-[0.3em] mb-10">Elite Operational Audit</p>
            
            <div class="bg-white/5 rounded-2xl p-6 mb-8 text-left border border-white/5">
                <p class="text-slate-300 text-sm leading-relaxed">Supera 10 desaf√≠os aleatorios de gesti√≥n t√©cnica para validar tu rango en el centro de mando log√≠stico.</p>
            </div>

            <button onclick="startGame()" class="w-full py-5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl font-black uppercase tracking-[0.3em] text-[10px] transition-all shadow-lg active:scale-95">
                INICIALIZAR SISTEMA
            </button>
        </div>
    </div>

    <!-- UI DEL JUEGO -->
    <div id="game-ui" class="hidden pointer-events-none">
        <div class="fixed top-0 left-0 w-full h-1 bg-white/5 z-20">
            <div id="progress-bar" class="progress-bar-fill h-full bg-blue-500" style="width: 0%"></div>
        </div>

        <div class="fixed top-4 left-4 right-4 flex justify-between z-10">
            <div class="flex gap-3">
                <div class="bg-slate-900/90 glass-panel p-3 px-6 rounded-2xl pointer-events-auto min-w-[140px] border-l-4 border-l-blue-500">
                    <div class="text-[8px] font-black text-blue-400 uppercase mb-0.5">PROFIT</div>
                    <div id="score-ui" class="text-2xl font-black text-white tabular-nums">0‚Ç¨</div>
                </div>
                <div class="bg-slate-900/90 glass-panel p-3 px-6 rounded-2xl pointer-events-auto">
                    <div class="text-[8px] font-black text-purple-400 uppercase mb-0.5">RETO</div>
                    <div id="level-ui" class="text-2xl font-black text-white tabular-nums">1/10</div>
                </div>
            </div>
            <div class="bg-slate-900/90 glass-panel p-3 px-6 rounded-2xl pointer-events-auto min-w-[120px]">
                <div class="text-[8px] font-black text-orange-500 uppercase mb-0.5 text-right">SYNC</div>
                <div id="timer-ui" class="text-2xl font-black text-white tabular-nums text-right">120s</div>
            </div>
        </div>

        <div class="fixed bottom-6 left-6 right-6 flex justify-between items-center z-10">
            <div class="flex gap-2 pointer-events-auto">
                <a href="index.html" class="bg-slate-900/90 glass-panel px-4 py-2 rounded-xl text-[8px] font-black uppercase tracking-widest flex items-center gap-2">
                    <i data-lucide="power" class="w-3 h-3"></i> SALIR
                </a>
                <button onclick="restartGame()" class="bg-slate-900/90 glass-panel px-4 py-2 rounded-xl text-[8px] font-black uppercase tracking-widest flex items-center gap-2">
                    <i data-lucide="rotate-ccw" class="w-3 h-3"></i> REINICIAR
                </button>
            </div>
            <div class="text-[8px] font-black text-slate-600 uppercase tracking-[0.5em]">SYSTEM_v6.4_STABLE</div>
        </div>
    </div>

    <!-- MODAL DE FEEDBACK -->
    <div id="feedback-modal" class="modal-blur items-center justify-center p-4">
        <div class="bg-slate-950/90 border border-white/10 rounded-[3rem] max-w-md w-full max-h-[85vh] flex flex-col overflow-hidden shadow-2xl relative">
            <div id="modal-header" class="p-8 text-white flex justify-between items-center bg-blue-600 shrink-0">
                <div>
                    <span id="modal-status" class="text-[9px] font-black uppercase tracking-[0.4em] opacity-80 block mb-1">AN√ÅLISIS</span>
                    <h3 id="modal-title" class="text-xl font-black uppercase italic tracking-tighter">¬°√âXITO!</h3>
                </div>
                <i id="modal-icon" data-lucide="check-circle" class="w-8 h-8"></i>
            </div>
            
            <div id="modal-content" class="p-10 space-y-6 overflow-y-auto relative z-10">
                <div id="feedback-body">
                    <div class="text-center mb-8">
                        <p id="modal-desc" class="text-slate-100 text-lg leading-relaxed font-light italic">...</p>
                    </div>
                    <div class="bg-blue-600/10 p-6 rounded-3xl border border-blue-500/20 flex items-start gap-5">
                        <div class="w-12 h-12 bg-orange-600 text-white rounded-2xl flex items-center justify-center shrink-0 shadow-lg">
                            <i data-lucide="lightbulb" class="w-6 h-6"></i>
                        </div>
                        <div>
                            <h4 class="text-[9px] font-black text-orange-400 uppercase mb-1">HACK LOG√çSTICO</h4>
                            <p id="modal-tip" class="text-white text-sm font-medium leading-snug">...</p>
                        </div>
                    </div>
                </div>
                <button id="next-btn" onclick="closeModal()" class="w-full bg-white text-black py-5 rounded-[2rem] font-black uppercase text-[10px] tracking-widest hover:bg-blue-600 hover:text-white transition-all">
                    CONTINUAR <i data-lucide="chevron-right" class="w-4 h-4 inline ml-2"></i>
                </button>
                <div id="gameover-btns" class="hidden space-y-3">
                    <button onclick="restartGame()" class="w-full bg-blue-600 text-white py-5 rounded-[2rem] font-black uppercase text-[10px]">NUEVA AUDITOR√çA</button>
                    <a href="index.html" class="block w-full bg-white/5 text-white py-5 rounded-[2rem] font-black uppercase text-[10px] text-center">HUB PRINCIPAL</a>
                </div>
            </div>
        </div>
    </div>

    <div id="game-container"></div>

    <script>
        const allQuestions = [
            { icon: "üíé", q: "¬øQu√© porcentaje de valor suelen representar los productos de Clase A?", a: ["20%", "80%", "50%", "5%"], correct: 1, hint: "Poco volumen f√≠sico, pero m√°xima inversi√≥n econ√≥mica.", fbCorrect: "¬°Impecable! Regla de Pareto: el 20% de las referencias valen el 80% del dinero.", fbWrong: "Fallo. Recuerda la regla 80/20: pocos art√≠culos concentran casi todo el valor." },
            { icon: "üõ°Ô∏è", q: "¬øCu√°l es la funci√≥n del Stock de Seguridad?", a: ["Ahorrar espacio", "Cubrir picos de demanda", "Evitar impuestos", "Facilitar limpieza"], correct: 1, hint: "Es tu colch√≥n contra la incertidumbre.", fbCorrect: "¬°Exacto! Te salva de la rotura de stock cuando el proveedor falla o la venta se dispara.", fbWrong: "Incorrecto. Es una reserva estrat√©gica para emergencias." },
            { icon: "üîÑ", q: "En el m√©todo FIFO, ¬øqu√© productos salen primero?", a: ["Los m√°s caros", "Los m√°s antiguos", "Los m√°s nuevos", "Los m√°s grandes"], correct: 1, hint: "First In, First Out.", fbCorrect: "¬°Perfecto! Fundamental para evitar la caducidad.", fbWrong: "Error. FIFO prioriza la salida de lo que lleva m√°s tiempo en el almac√©n." },
            { icon: "üÜî", q: "¬øQu√© identifica un SKU?", a: ["Un cami√≥n", "Un art√≠culo √∫nico", "Una estanter√≠a", "Un empleado"], correct: 1, hint: "Es el 'DNI' de cada variante de producto.", fbCorrect: "¬°Correcto! Cada talla o color tiene su propio SKU.", fbWrong: "Fallo. El SKU es el c√≥digo √∫nico de referencia de cada unidad." },
            { icon: "üß†", q: "¬øQu√© es un SGA en el contexto actual?", a: ["Un Seguro", "Software de Gesti√≥n de Almac√©n", "Sistema de Gasto", "Servicio de Gr√∫as"], correct: 1, hint: "Cerebro inform√°tico operativo.", fbCorrect: "¬°Esencial! El software que sabe d√≥nde est√° cada caja en tiempo real.", fbWrong: "Incorrecto. Es el Sistema de Gesti√≥n de Almacenes." },
            { icon: "üìâ", q: "La 'Merma Desconocida' suele deberse a...", a: ["Bajar precios", "Hurtos y errores", "Fr√≠o almac√©n", "Exceso de stock"], correct: 1, hint: "P√©rdidas invisibles sin registro.", fbCorrect: "¬°Ojo cl√≠nico! El robo interno/externo y errores de registro son las causas principales.", fbWrong: "Error. Son p√©rdidas causadas mayormente por hurtos o fallos." },
            { icon: "‚öñÔ∏è", q: "El Modelo de Wilson busca el equilibrio entre...", a: ["Orden", "Coste pedido y almacenaje", "Ventas", "Peso"], correct: 1, hint: "Pedir vs Guardar.", fbCorrect: "¬°Matem√°tico! Minimizas el gasto total encontrando el lote √≥ptimo.", fbWrong: "Fallo. Equilibra el coste de lanzar pedidos vs mantener stock." },
            { icon: "‚è±Ô∏è", q: "¬øQu√© mide el 'Lead Time'?", a: ["Precio", "Tiempo pedido-entrega", "Calidad", "Horario"], correct: 1, hint: "Tiempo de reabastecimiento.", fbCorrect: "¬°Cierto! Dato cr√≠tico para saber cu√°ndo lanzar la reposici√≥n.", fbWrong: "No. Es el tiempo total desde el pedido hasta la recepci√≥n." },
            { icon: "üì°", q: "Ventaja principal del RFID:", a: ["Barato", "Lectura masiva sin contacto", "Colores", "Comestible"], correct: 1, hint: "Ondas de radio.", fbCorrect: "¬°Tecnolog√≠a punta! Puedes inventariar un pal√© entero en segundos.", fbWrong: "Fallo. El RFID permite lecturas a distancia y m√∫ltiples." },
            { icon: "‚ö°", q: "¬øQu√© es el Cross-docking?", a: ["Cruzar pasillos", "Paso directo entrada-salida", "Limpiar", "Apilar"], correct: 1, hint: "Sin almacenaje intermedio.", fbCorrect: "¬°Velocidad pura! Ahorras costes de manipulaci√≥n y espacio.", fbWrong: "Incorrecto. Es el flujo directo sin pasar por estanter√≠a." }
        ];

        let questions = [], score = 0, currentQuestionIdx = 0, timeLeft = 120, gameActive = false, phaserInstance = null, timerInterval = null;

        const config = {
            type: Phaser.AUTO, parent: 'game-container', transparent: true,
            scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH, width: 1000, height: 600 },
            physics: { default: 'arcade' },
            scene: { preload, create, update }
        };

        function preload() {}
        function create() {
            phaserInstance = this;
            this.grid = this.add.graphics();
            this.grid.lineStyle(1, 0x3b82f6, 0.05);
            for(let i=0; i<25; i++) {
                this.grid.moveTo(i*40, 0); this.grid.lineTo(i*40, 600);
                this.grid.moveTo(0, i*40); this.grid.lineTo(1000, i*40);
            }
            this.grid.strokePath();
            if(gameActive) showQuestion();
        }
        function update() {}

        function startGame() {
            questions = allQuestions.sort(() => Math.random() - 0.5).slice(0, 10);
            currentQuestionIdx = 0; score = 0; timeLeft = 120; gameActive = true;
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-ui').classList.remove('hidden');
            if(!phaserInstance) new Phaser.Game(config);
            else { phaserInstance.scene.restart(); showQuestion(); }
            startTimer();
        }

        function restartGame() {
            document.getElementById('feedback-modal').style.display = 'none';
            startGame();
        }

        function startTimer() {
            if(timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if(gameActive && timeLeft > 0) {
                    timeLeft--;
                    document.getElementById('timer-ui').innerText = timeLeft + 's';
                    if(timeLeft <= 0) gameOver();
                }
            }, 1000);
        }

        function showQuestion() {
            const q = questions[currentQuestionIdx];
            if(phaserInstance.qContainer) phaserInstance.qContainer.destroy();
            const container = phaserInstance.add.container(500, 300);
            phaserInstance.qContainer = container;

            const qBox = phaserInstance.add.rectangle(-240, 0, 420, 280, 0x0f172a, 0.8).setStrokeStyle(2, 0x3b82f6, 0.4);
            const qIcon = phaserInstance.add.text(-240, -80, q.icon, { fontSize: '64px' }).setOrigin(0.5);
            const qTxt = phaserInstance.add.text(-240, 40, q.q, { fontSize: '22px', fontWeight: '900', color: '#fff', fontFamily: 'Outfit', align: 'center', wordWrap: { width: 360 } }).setOrigin(0.5);

            q.a.forEach((opt, idx) => {
                const yPos = -100 + (idx * 65); 
                const btnBg = phaserInstance.add.rectangle(180, yPos, 360, 55, 0x1e293b, 0.9).setStrokeStyle(1, 0x3b82f6, 0.2).setInteractive({ useHandCursor: true });
                const btnLetter = phaserInstance.add.text(180 - 150, yPos, String.fromCharCode(65 + idx), { fontSize: '12px', fontWeight: '900', color: '#fff', backgroundColor: '#2563eb', padding: { x: 8, y: 8 } }).setOrigin(0.5);
                const btnTxt = phaserInstance.add.text(180 - 110, yPos, opt, { fontSize: '15px', fontWeight: '600', color: '#cbd5e1', wordWrap: { width: 260 } }).setOrigin(0, 0.5);

                btnBg.on('pointerdown', () => { if(gameActive) handleAnswer(idx === q.correct); });
                btnBg.on('pointerover', () => { btnBg.setFillStyle(0x2563eb, 1); });
                btnBg.on('pointerout', () => { btnBg.setFillStyle(0x1e293b, 0.9); });
                container.add([btnBg, btnLetter, btnTxt]);
            });
            container.add([qBox, qIcon, qTxt]);
            container.alpha = 0;
            phaserInstance.tweens.add({ targets: container, alpha: 1, duration: 300 });
            document.getElementById('level-ui').innerText = (currentQuestionIdx + 1) + "/10";
            document.getElementById('progress-bar').style.width = (currentQuestionIdx * 10) + "%";
        }

        function handleAnswer(isCorrect) {
            gameActive = false; score += isCorrect ? 250 : 0;
            document.getElementById('score-ui').innerText = score + '‚Ç¨';
            if(isCorrect) {
                for(let i=0; i<10; i++) {
                    let p = phaserInstance.add.circle(500, 300, 4, 0xfacc15);
                    phaserInstance.physics.add.existing(p);
                    p.body.setVelocity(Phaser.Math.Between(-200, 200), Phaser.Math.Between(-200, 200));
                    phaserInstance.tweens.add({ targets: p, alpha: 0, duration: 1000, onComplete: () => p.destroy() });
                }
            }
            showFeedbackModal(isCorrect, questions[currentQuestionIdx]);
        }

        function showFeedbackModal(isCorrect, data) {
            const modal = document.getElementById('feedback-modal');
            modal.style.display = 'flex';
            document.getElementById('modal-title').innerText = isCorrect ? '¬°√âXITO!' : 'FALLO';
            document.getElementById('modal-header').className = isCorrect ? 'p-8 text-white flex justify-between items-center bg-emerald-600 shrink-0' : 'p-8 text-white flex justify-between items-center bg-rose-600 shrink-0';
            document.getElementById('modal-desc').innerHTML = isCorrect ? data.fbCorrect : data.fbWrong;
            document.getElementById('modal-tip').innerText = data.hint;
            document.getElementById('feedback-body').classList.remove('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            document.getElementById('gameover-btns').classList.add('hidden');
            lucide.createIcons();
        }

        function closeModal() {
            document.getElementById('feedback-modal').style.display = 'none';
            currentQuestionIdx++;
            if (currentQuestionIdx >= 10) gameOver(true);
            else { gameActive = true; showQuestion(); }
        }

        function gameOver(completed) {
            gameActive = false; clearInterval(timerInterval);
            const modal = document.getElementById('feedback-modal');
            modal.style.display = 'flex';
            document.getElementById('modal-title').innerText = 'RESULTADO';
            document.getElementById('modal-header').className = 'p-8 text-white flex justify-between items-center bg-slate-800 shrink-0';
            document.getElementById('feedback-body').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('gameover-btns').classList.remove('hidden');
            lucide.createIcons();
        }

        lucide.createIcons();
    </script>
</body>
</html>