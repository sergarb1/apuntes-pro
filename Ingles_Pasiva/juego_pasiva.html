<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Passive Voice Master: Neon Quiz</title>
    <!-- Bootstrap 5 & FontAwesome 6 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --primary-color: #bb86fc;
            --secondary-color: #03dac6;
            --error-color: #cf6679;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: var(--text-primary);
            height: 100dvh;
            user-select: none;
        }

        #game-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; 
            display: flex;
            flex-direction: column;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .interactive-area {
            pointer-events: auto;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 15px;
            max-height: 100dvh;
            overflow-y: auto;
        }

        /* --- START SCREEN --- */
        #start-screen {
            text-align: center;
            background: rgba(18, 18, 18, 0.85);
            backdrop-filter: blur(8px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(187, 134, 252, 0.3);
            box-shadow: 0 0 50px rgba(187, 134, 252, 0.1);
            margin: auto;
        }
        
        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
            filter: drop-shadow(0 0 10px rgba(187, 134, 252, 0.5));
        }

        .instruction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .instruction-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .instruction-icon {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
            border-radius: 0 0 15px 15px;
            margin: 0 10px;
        }

        .score-badge {
            background: rgba(187, 134, 252, 0.2);
            color: var(--primary-color);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            border: 1px solid var(--primary-color);
        }

        .timer-bar {
            height: 4px;
            background: #333;
            width: 100%;
            position: absolute;
            bottom: 0;
            left: 0;
        }

        .timer-fill {
            height: 100%;
            background: var(--secondary-color);
            width: 100%;
            transition: width 0.1s linear;
        }

        /* Question Card */
        .question-card {
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.5s ease-out;
            position: relative;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .question-subtext {
            color: var(--secondary-color);
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
        }

        /* Options */
        .options-grid {
            display: grid;
            gap: 15px;
            width: 100%;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 20px;
            border-radius: 12px;
            font-size: 1.1rem;
            text-align: left;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .option-btn:hover, .option-btn:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .option-btn.selected {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: #000;
        }

        .option-btn.correct {
            background: rgba(3, 218, 198, 0.2);
            border-color: var(--secondary-color);
            color: var(--secondary-color);
        }

        .option-btn.incorrect {
            background: rgba(207, 102, 121, 0.2);
            border-color: var(--error-color);
            color: var(--error-color);
        }

        .option-icon {
            margin-right: 15px;
            width: 30px;
            text-align: center;
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .feedback-card {
            background: var(--surface-color);
            padding: 40px;
            border-radius: 20px;
            max-width: 90%;
            width: 500px;
            text-align: center;
            border: 2px solid;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        .modal-overlay.active .feedback-card {
            transform: scale(1);
        }

        .feedback-success { border-color: var(--secondary-color); box-shadow: 0 0 30px rgba(3, 218, 198, 0.3); }
        .feedback-error { border-color: var(--error-color); box-shadow: 0 0 30px rgba(207, 102, 121, 0.3); }

        .btn-action {
            background: var(--primary-color);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 20px;
            width: 100%;
            transition: transform 0.1s;
            cursor: pointer;
        }

        .btn-action:hover {
            filter: brightness(1.1);
        }

        .btn-action:active { transform: scale(0.95); }

        .btn-icon {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: color 0.2s;
            padding: 5px;
        }
        
        .btn-icon:hover { color: var(--primary-color); }

        .cheat-sheet-list {
            text-align: left;
            list-style: none;
            padding: 0;
        }
        .cheat-sheet-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .cheat-sheet-list strong { color: var(--secondary-color); }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Animations for Phaser Background */
        canvas {
            display: block;
        }

        /* Mobile specific */
        @media (max-width: 600px) {
            #start-screen { padding: 20px; }
            .hero-title { font-size: 2.2rem; }
            .instruction-grid { gap: 10px; margin: 15px 0; }
            .instruction-card { padding: 10px; }
            .instruction-card h5 { font-size: 0.9rem; margin-bottom: 2px; }
            .instruction-card p { font-size: 0.75rem; }
            .alert { padding: 10px; margin-bottom: 15px; font-size: 0.8rem; }
            .btn-action { padding: 10px 20px; font-size: 1rem; margin-top: 10px; }
            .question-text { font-size: 1.1rem; }
            .option-btn { padding: 12px; font-size: 0.95rem; }
        }
    </style>
</head>
<body>

<!-- Phaser Game Container -->
<div id="game-container"></div>

<!-- UI Layer -->
<div id="ui-layer">
    
    <!-- START SCREEN -->
    <div id="start-screen" class="interactive-area">
        <h1 class="hero-title"><i class="fas fa-magic"></i> Passive<br>Master</h1>
        <p class="lead text-muted">Neon Edition v2.1</p>
        
        <div class="instruction-grid">
            <div class="instruction-card">
                <div class="instruction-icon"><i class="fas fa-random"></i></div>
                <h5>Random 10</h5>
                <p class="small text-muted">Every game is a new challenge with 10 random questions.</p>
            </div>
            <div class="instruction-card">
                <div class="instruction-icon"><i class="fas fa-stopwatch"></i></div>
                <h5>Be Fast</h5>
                <p class="small text-muted">Answer quickly to maximize your score.</p>
            </div>
            <div class="instruction-card">
                <div class="instruction-icon"><i class="fas fa-graduation-cap"></i></div>
                <h5>Master It</h5>
                <p class="small text-muted">Learn from detailed feedback on every answer.</p>
            </div>
        </div>

        <div class="alert alert-dark border-0 bg-opacity-25 bg-secondary text-light mb-4">
            <i class="fas fa-lightbulb text-warning me-2"></i><strong>Pro Tip:</strong> 
            <span id="random-tip">...</span>
        </div>

        <button class="btn-action" onclick="gameLogic.startGame()">
            START QUIZ <i class="fas fa-play ms-2"></i>
        </button>
    </div>

    <!-- GAME UI (Hidden Initially) -->
    <div id="game-ui" style="display:none; height: 100%; flex-direction: column;">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="d-flex align-items-center">
                <button class="btn-icon me-3" onclick="gameLogic.restartGame()" title="Restart Game">
                    <i class="fas fa-redo"></i>
                </button>
                <div class="d-flex align-items-center me-3">
                    <i class="fas fa-layer-group text-primary me-2"></i>
                    <span id="question-counter">1/10</span>
                </div>
            </div>

            <div class="score-badge">
                <i class="fas fa-trophy me-2"></i><span id="score-display">0</span>
            </div>

            <button class="btn-icon ms-3" onclick="gameLogic.showCheatSheet()" title="Grammar Help">
                <i class="fas fa-circle-question"></i>
            </button>
            
            <div class="timer-bar"><div class="timer-fill" id="timer-bar"></div></div>
        </div>

        <!-- Main Quiz Area -->
        <div class="interactive-area" id="quiz-area">
            <div class="question-card">
                <h2 class="question-text" id="question-text">Loading...</h2>
                <p class="question-subtext" id="question-subtext">Select the correct option</p>
            </div>

            <div class="options-grid" id="options-container">
                <!-- Options injected by JS -->
            </div>
        </div>
    </div>
</div>

<!-- Feedback Modal -->
<div class="modal-overlay" id="feedback-modal">
    <div class="feedback-card" id="feedback-card-inner">
        <div class="mb-3">
            <i class="fas fa-4x" id="feedback-icon"></i>
        </div>
        <h3 id="feedback-title" class="mb-3">Title</h3>
        <p id="feedback-message" class="mb-4 lead">Message goes here</p>
        <div id="feedback-detail" class="text-muted mb-4 small"></div>
        <button class="btn-action" id="next-btn">Next Question <i class="fas fa-arrow-right ms-2"></i></button>
    </div>
</div>

<!-- Cheat Sheet Modal -->
<div class="modal-overlay" id="cheat-modal">
    <div class="feedback-card" style="border-color: var(--secondary-color); width: 600px;">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="m-0 text-info"><i class="fas fa-book me-2"></i>Quick Guide</h3>
            <button class="btn-icon" onclick="document.getElementById('cheat-modal').classList.remove('active')"><i class="fas fa-times"></i></button>
        </div>
        <ul class="cheat-sheet-list">
            <li><strong>General Rule:</strong> Object + BE + Past Participle (+ by Agent)</li>
            <li><strong>Present Simple:</strong> am/is/are + Participle</li>
            <li><strong>Past Simple:</strong> was/were + Participle</li>
            <li><strong>Continuous:</strong> be + BEING + Participle</li>
            <li><strong>Perfect:</strong> have/has + BEEN + Participle</li>
            <li><strong>Modals:</strong> can/must/will + BE + Participle</li>
        </ul>
        <button class="btn-action mt-3" onclick="document.getElementById('cheat-modal').classList.remove('active')">Got it!</button>
    </div>
</div>

<!-- TDAH Pause Modal -->
<div class="modal-overlay" id="pause-modal">
    <div class="feedback-card" style="border-color: #3b82f6;">
        <div class="mb-3">
            <i class="fas fa-brain fa-4x text-primary fa-spin" style="animation-duration: 3s;"></i>
        </div>
        <h3>Brain Break! ðŸ§ </h3>
        <p class="mb-4">Great focus! Take 10 seconds to stretch, look away from the screen, or take a deep breath.</p>
        <button class="btn-action" onclick="gameLogic.resumeFromPause()">I'm Ready!</button>
    </div>
</div>

<script>
    // --- Data: 50 Questions Pool ---
    const quizData = [
        // 1-10
        { q: "The students cleaned the classroom.", sub: "Transform to Passive Voice", options: ["The classroom was cleaned by the students.", "The classroom is cleaned by the students.", "The classroom were cleaned by the students."], correct: 0, feedback: "Excellent! Past Simple 'cleaned' becomes 'was cleaned'. The object 'classroom' is singular." },
        { q: "The new bridge will be built next year.", sub: "Identify the Voice", options: ["Passive Voice", "Active Voice", "Future Perfect"], correct: 0, feedback: "Correct! 'Will be built' is the Passive Future form (Will + Be + Participle)." },
        { q: "People speak English all over the world.", sub: "Transform to Passive Voice", options: ["English is spoken all over the world.", "English was spoken all over the world.", "English speaks all over the world."], correct: 0, feedback: "Perfect! 'Speak' (Present) becomes 'Is spoken'. We omit 'People' as it's a general subject." },
        { q: "My mother is baking a cake.", sub: "Identify the Voice", options: ["Active Voice", "Passive Voice", "Present Perfect"], correct: 0, feedback: "That's it! 'My mother' (Subject) is doing the action. The Passive would be 'A cake is being baked'." },
        { q: "They have finished the project.", sub: "Transform to Passive Voice", options: ["The project has been finished.", "The project have been finished.", "The project was finished."], correct: 0, feedback: "Well done! Present Perfect 'Have finished' becomes 'Has been finished' (singular project)." },
        { q: "Someone stole my car.", sub: "Transform to Passive Voice", options: ["My car was stolen.", "My car is stolen.", "My car has been stolen."], correct: 0, feedback: "Exactly! Past Simple 'stole' -> 'was stolen'. The agent 'someone' is unknown, so we omit it." },
        { q: "The strong wind damaged the roof.", sub: "Select the correct passive form", options: ["The roof was damaged by the strong wind.", "The roof damaged by the strong wind.", "The roof is damaged by the strong wind."], correct: 0, feedback: "Spot on! 'Was damaged' is correct for the past event. We keep 'by the strong wind' as it's the specific cause." },
        { q: "They are building a new hospital.", sub: "Transform to Passive Voice", options: ["A new hospital is being built.", "A new hospital is built.", "A new hospital was being built."], correct: 0, feedback: "Nice job! Continuous 'are building' needs 'being' -> 'is being built'." },
        { q: "Doctors have discovered a new cure.", sub: "Transform to Passive Voice", options: ["A new cure has been discovered.", "A new cure is discovered.", "A new cure have been discovered."], correct: 0, feedback: "Correct! 'Has been discovered'. The focus is now on the cure, not the doctors." },
        { q: "The police arrested the suspect.", sub: "Transform to Passive Voice", options: ["The suspect was arrested.", "The suspect were arrested.", "The suspect is arrested."], correct: 0, feedback: "Right! 'Was arrested'. The context implies police, so we often omit the agent." },
        
        // 11-20
        { q: "Shakespeare wrote Hamlet.", sub: "Transform to Passive Voice", options: ["Hamlet was written by Shakespeare.", "Hamlet wrote by Shakespeare.", "Hamlet is written by Shakespeare."], correct: 0, feedback: "Classic! Works of art use Past Simple Passive: 'Was written by...'." },
        { q: "We must sign the contract.", sub: "Transform to Passive Voice", options: ["The contract must be signed.", "The contract must sign.", "The contract was signed."], correct: 0, feedback: "Good! Modals (Must) don't change. Add 'BE' + Participle: 'Must be signed'." },
        { q: "I will send the email tomorrow.", sub: "Identify the Voice", options: ["Active Voice", "Passive Voice", "Past Continuous"], correct: 0, feedback: "Correct! 'I' am the doer. It's Active. Passive: 'The email will be sent'." },
        { q: "Did they fix the window?", sub: "Transform Question to Passive", options: ["Was the window fixed?", "Did the window fixed?", "Is the window fixed?"], correct: 0, feedback: "Smart! For questions in Past Passive, start with 'Was/Were' + Object + Participle." },
        { q: "The chef prepares the food daily.", sub: "Complete the Passive: The food ___ daily.", options: ["is prepared", "was prepared", "is being prepared"], correct: 0, feedback: "Yes! 'Daily' implies routine (Present Simple) -> 'Is prepared'." },
        { q: "The government is going to pass a new law.", sub: "Passive version:", options: ["A new law is going to be passed.", "A new law will passed.", "A new law is being passed."], correct: 0, feedback: "Correct! 'Going to' + 'Be' + 'Passed'. The structure remains consistent." },
        { q: "Nobody has invited me to the party.", sub: "Passive version (careful with negatives):", options: ["I haven't been invited to the party.", "I have been invited by nobody.", "I wasn't invited to the party."], correct: 0, feedback: "Tricky one! 'Nobody' usually triggers a negative verb form: 'Have not been invited'." },
        { q: "You can see the mountains from here.", sub: "Passive version:", options: ["The mountains can be seen from here.", "The mountains could be seen from here.", "The mountains can see from here."], correct: 0, feedback: "Right! Modal 'Can' + 'Be' + 'Seen'. Perfect." },
        { q: "The company had already sold the tickets.", sub: "Passive version:", options: ["The tickets had already been sold.", "The tickets were already sold.", "The tickets have already been sold."], correct: 0, feedback: "Excellent. Past Perfect 'Had sold' -> 'Had been sold'." },
        { q: "The technician is repairing my computer.", sub: "Passive version:", options: ["My computer is being repaired.", "My computer is repaired.", "My computer will be repaired."], correct: 0, feedback: "Yes! 'Is repairing' -> 'Is BEING repaired'. Don't forget 'being' for actions in progress." },

        // 21-30
        { q: "They were filming a movie in town.", sub: "Passive version:", options: ["A movie was being filmed in town.", "A movie was filmed in town.", "A movie were being filmed."], correct: 0, feedback: "Correct! Past Continuous 'Were filming' -> 'Was being filmed' (Movie is singular)." },
        { q: "The waiter has served the coffee.", sub: "Identify the tense in this passive: 'The coffee has been served'.", options: ["Present Perfect Passive", "Past Simple Passive", "Present Simple Passive"], correct: 0, feedback: "Spot on! 'Has been' + Participle is the signature of Present Perfect Passive." },
        { q: "Firefighters rescued the cat.", sub: "Passive version:", options: ["The cat was rescued by firefighters.", "The cat were rescued by firefighters.", "The cat is rescued by firefighters."], correct: 0, feedback: "Right! 'The cat' is singular, so we use 'Was rescued'." },
        { q: "They make these shoes in Italy.", sub: "Passive version:", options: ["These shoes are made in Italy.", "These shoes were made in Italy.", "These shoes is made in Italy."], correct: 0, feedback: "Good! 'Shoes' are plural, so we use 'Are made'." },
        { q: "You should keep the door locked.", sub: "Passive version:", options: ["The door should be kept locked.", "The door should be keep locked.", "The door should kept locked."], correct: 0, feedback: "Correct! Modal 'Should' + 'Be' + 'Kept' (Participle)." },
        { q: "The manager will sign the reports.", sub: "Passive version:", options: ["The reports will be signed.", "The reports will being signed.", "The reports is going to be signed."], correct: 0, feedback: "Yes! Future 'Will sign' -> 'Will be signed'." },
        { q: "People are cutting down the rainforest.", sub: "Passive version:", options: ["The rainforest is being cut down.", "The rainforest are being cut down.", "The rainforest is cut down."], correct: 0, feedback: "Important! 'Rainforest' is singular -> 'Is being cut down'." },
        { q: "They expect the president to arrive soon.", sub: "Passive version (It-construction):", options: ["It is expected that the president will arrive soon.", "The president is expect to arrive soon.", "It was expected that the president arrives soon."], correct: 0, feedback: "Advanced! Reporting verbs often start with 'It is [participle] that...'." },
        { q: "The wind blew away the papers.", sub: "Passive version:", options: ["The papers were blown away by the wind.", "The papers was blown away by the wind.", "The papers were blew away."], correct: 0, feedback: "Correct! 'Papers' are plural -> 'Were blown away'." },
        { q: "The teacher has explained the rules.", sub: "Passive version:", options: ["The rules have been explained.", "The rules has been explained.", "The rules were explained."], correct: 0, feedback: "Watch the number! 'Teacher' (singular) has, but 'Rules' (plural) HAVE been." },

        // 31-40
        { q: "They can solve the problem easily.", sub: "Passive version:", options: ["The problem can be solved easily.", "The problem can solved easily.", "The problem could be solved easily."], correct: 0, feedback: "Correct! Modal 'Can' + 'Be' + 'Solved'." },
        { q: "Someone was recording our conversation.", sub: "Passive version:", options: ["Our conversation was being recorded.", "Our conversation was recorded.", "Our conversation is being recorded."], correct: 0, feedback: "Yes! Past Continuous: 'Was being recorded'. The action was happening at that moment." },
        { q: "The teacher gives homework every day.", sub: "Passive version:", options: ["Homework is given every day.", "Homework are given every day.", "Homework is gave every day."], correct: 0, feedback: "Good! 'Homework' is uncountable (singular) -> 'Is given'." },
        { q: "You must not touch this button.", sub: "Passive version:", options: ["This button must not be touched.", "This button must not touched.", "This button must not be touch."], correct: 0, feedback: "Safety first! Negative Modal: 'Must not' + 'Be' + 'Touched'." },
        { q: "They had lost the key.", sub: "Passive version:", options: ["The key had been lost.", "The key has been lost.", "The key was lost."], correct: 0, feedback: "Right! Past Perfect 'Had lost' -> 'Had been lost'." },
        { q: "Scientists are studying the virus.", sub: "Passive version:", options: ["The virus is being studied.", "The virus is studying.", "The virus was being studied."], correct: 0, feedback: "Correct! Present Continuous: 'Is being studied' right now." },
        { q: "She will bring the snacks.", sub: "Passive version:", options: ["The snacks will be brought.", "The snacks will be bring.", "The snacks are brought."], correct: 0, feedback: "Yum! 'Will' + 'Be' + 'Brought' (irregular participle)." },
        { q: "Someone has stolen my bike.", sub: "Passive version:", options: ["My bike has been stolen.", "My bike was stolen.", "My bike is stolen."], correct: 0, feedback: "Correct! Present Perfect: 'Has been stolen' (Result allows emphasis on the missing bike)." },
        { q: "We make butter from milk.", sub: "Passive version:", options: ["Butter is made from milk.", "Butter are made from milk.", "Butter is make from milk."], correct: 0, feedback: "Right! General fact (Present Simple): 'Butter' (uncountable) 'Is made'." },
        { q: "They were cleaning the windows.", sub: "Passive version:", options: ["The windows were being cleaned.", "The windows were cleaned.", "The windows are being cleaned."], correct: 0, feedback: "Shiny! Past Continuous: 'Were being cleaned' (Plural windows)." },

        // 41-50
        { q: "You ought to fix the roof.", sub: "Passive version:", options: ["The roof ought to be fixed.", "The roof ought be fixed.", "The roof ought to fixed."], correct: 0, feedback: "Formal Modal! 'Ought to' + 'Be' + 'Fixed'." },
        { q: "Did anyone answer your question?", sub: "Passive version:", options: ["Was your question answered?", "Did your question answered?", "Was your question answer?"], correct: 0, feedback: "Question form: 'Was' + Subject + Participle?" },
        { q: "They offered him a job.", sub: "Passive version (Starting with 'He'):", options: ["He was offered a job.", "He offered a job.", "He was offer a job."], correct: 0, feedback: "Great! In English, a person can be the subject of a passive sentence." },
        { q: "People believe that he is innocent.", sub: "Passive version (Impersonal):", options: ["It is believed that he is innocent.", "He is believed innocent.", "It believes that he is innocent."], correct: 0, feedback: "Excellent! 'It is believed that...' is a common formal structure." },
        { q: "He is writing a letter.", sub: "Passive version:", options: ["A letter is being written.", "A letter is written.", "A letter was being written."], correct: 0, feedback: "Correct! 'Is being written' (Action in progress)." },
        { q: "The storm destroyed the house.", sub: "Passive version:", options: ["The house was destroyed by the storm.", "The house is destroyed by the storm.", "The house destroyed by the storm."], correct: 0, feedback: "Right! Past Simple: 'Was destroyed'. Specific event in the past." },
        { q: "They have postponed the concert.", sub: "Passive version:", options: ["The concert has been postponed.", "The concert have been postponed.", "The concert was postponed."], correct: 0, feedback: "Correct! 'Has been postponed'. Concert is singular." },
        { q: "You should wash your hands.", sub: "Passive version:", options: ["Your hands should be washed.", "Your hands should washed.", "Your hands should be wash."], correct: 0, feedback: "Hygiene! Modal 'Should' + 'Be' + 'Washed'." },
        { q: "They will have finished the bridge by June.", sub: "Passive version (Future Perfect):", options: ["The bridge will have been finished by June.", "The bridge will be finished by June.", "The bridge will have finished by June."], correct: 0, feedback: "Pro Level! Future Perfect: 'Will have been finished'." },
        { q: "They sent the letter yesterday.", sub: "Passive version:", options: ["The letter was sent yesterday.", "The letter is sent yesterday.", "The letter has been sent yesterday."], correct: 0, feedback: "Final one! Past Simple with time marker 'Yesterday' -> 'Was sent'." }
    ];

    const grammarTips = [
        "In Passive, the object of the active sentence becomes the SUBJECT.",
        "Always use the verb TO BE in the same tense as the active sentence.",
        "Use 'BY' only if the agent (who did it) is important or surprising.",
        "Intransitive verbs (like 'arrive' or 'sleep') cannot be passive.",
        "Perfect tenses always include 'BEEN' in the passive voice.",
        "Continuous tenses always include 'BEING' in the passive voice."
    ];

    // --- Phaser Background Scene ---
    class BackgroundScene extends Phaser.Scene {
        constructor() { super({ key: 'BackgroundScene' }); }
        create() {
            const width = this.scale.width;
            const height = this.scale.height;
            this.graphics = this.add.graphics();
            this.drawBackground();

            const particles = this.add.particles(0, 0, 'flare', {
                x: { min: 0, max: width },
                y: { min: 0, max: height },
                quantity: 1,
                frequency: 200,
                lifespan: 5000,
                gravityY: -5,
                scale: { start: 0.05, end: 0 },
                alpha: { start: 0.4, end: 0 },
                blendMode: 'ADD'
            });

            const flare = this.make.graphics({x: 0, y: 0, add: false});
            flare.fillStyle(0xbb86fc, 1);
            flare.fillCircle(10, 10, 10);
            flare.generateTexture('flare', 20, 20);
            
            this.scale.on('resize', this.resize, this);
        }
        drawBackground() {
            const w = this.scale.width;
            const h = this.scale.height;
            this.graphics.clear();
            this.graphics.fillGradientStyle(0x121212, 0x121212, 0x2a0a38, 0x2a0a38, 1);
            this.graphics.fillRect(0, 0, w, h);
        }
        resize(gameSize) {
            this.cameras.main.setViewport(0, 0, gameSize.width, gameSize.height);
            this.drawBackground();
        }
    }

    // --- Game Logic Manager ---
    const gameLogic = {
        currentQuizSet: [],
        currentIndex: 0,
        score: 0,
        timer: 100,
        timerInterval: null,
        isPaused: false,
        streak: 0,

        init() {
            // Show start screen, hide game
            document.getElementById('start-screen').style.display = 'block';
            document.getElementById('game-ui').style.display = 'none';
            this.setRandomTip();
        },

        setRandomTip() {
            const tip = grammarTips[Math.floor(Math.random() * grammarTips.length)];
            document.getElementById('random-tip').innerText = tip;
        },

        startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-ui').style.display = 'flex';
            
            // Randomly select 10 questions
            this.currentQuizSet = [...quizData].sort(() => 0.5 - Math.random()).slice(0, 10);
            
            this.currentIndex = 0;
            this.score = 0;
            this.streak = 0;
            this.updateUI();
            this.loadQuestion();
        },

        restartGame() {
            if (confirm("Restart game? Current progress will be lost.")) {
                this.stopTimer();
                this.init();
            }
        },

        showCheatSheet() {
            document.getElementById('cheat-modal').classList.add('active');
        },

        startTimer() {
            this.stopTimer();
            this.timer = 100;
            document.getElementById('timer-bar').style.width = '100%';
            
            this.timerInterval = setInterval(() => {
                if (this.isPaused) return;
                
                this.timer -= 0.5; 
                const bar = document.getElementById('timer-bar');
                bar.style.width = `${this.timer}%`;

                if (this.timer < 30) bar.style.backgroundColor = '#cf6679'; 
                else bar.style.backgroundColor = '#03dac6';

                if (this.timer <= 0) {
                    this.handleTimeUp();
                }
            }, 100);
        },

        stopTimer() {
            if (this.timerInterval) clearInterval(this.timerInterval);
        },

        handleTimeUp() {
            this.stopTimer();
            this.showFeedback(false, -1);
        },

        loadQuestion() {
            if (this.currentIndex >= this.currentQuizSet.length) {
                this.endGame();
                return;
            }

            // TDAH Check: Pause at question 6 (halfway)
            if (this.currentIndex === 5) {
                this.isPaused = true;
                document.getElementById('pause-modal').classList.add('active');
                return; 
            }

            const data = this.currentQuizSet[this.currentIndex];
            document.getElementById('question-counter').innerText = `${this.currentIndex + 1}/${this.currentQuizSet.length}`;
            
            const qText = document.getElementById('question-text');
            qText.style.opacity = 0;
            setTimeout(() => {
                qText.innerText = data.q;
                document.getElementById('question-subtext').innerText = data.sub;
                qText.style.opacity = 1;
            }, 200);

            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            data.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `
                    <div class="option-icon"><i class="far fa-circle"></i></div>
                    <div>${opt}</div>
                `;
                btn.onclick = () => this.checkAnswer(index, btn);
                container.appendChild(btn);
            });

            this.startTimer();
        },

        checkAnswer(selectedIndex, btnElement) {
            this.stopTimer();
            
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.style.pointerEvents = 'none');

            const currentQ = this.currentQuizSet[this.currentIndex];
            const isCorrect = selectedIndex === currentQ.correct;

            if (isCorrect) {
                btnElement.classList.add('correct', 'selected');
                btnElement.querySelector('.option-icon i').className = 'fas fa-check-circle';
                this.score += 10 + (this.streak * 2);
                this.streak++;
            } else {
                btnElement.classList.add('incorrect', 'selected');
                btnElement.querySelector('.option-icon i').className = 'fas fa-times-circle';
                btns[currentQ.correct].classList.add('correct');
                btns[currentQ.correct].querySelector('.option-icon i').className = 'fas fa-check-circle';
                this.streak = 0;
            }

            this.updateUI();
            setTimeout(() => this.showFeedback(isCorrect, selectedIndex), 800);
        },

        showFeedback(isCorrect, selectedIndex) {
            const currentQ = this.currentQuizSet[this.currentIndex];
            const modal = document.getElementById('feedback-modal');
            const card = document.getElementById('feedback-card-inner');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const msg = document.getElementById('feedback-message');
            const detail = document.getElementById('feedback-detail');

            modal.classList.add('active');
            
            if (isCorrect) {
                card.className = 'feedback-card feedback-success';
                // Random Success Icon
                const successIcons = ['fa-trophy', 'fa-star', 'fa-thumbs-up', 'fa-medal'];
                const randIcon = successIcons[Math.floor(Math.random() * successIcons.length)];
                icon.className = `fas ${randIcon} text-success`;
                
                title.innerText = "Excellent!";
                title.className = "mb-3 text-success";
                msg.innerHTML = "That's the correct structure.";
            } else {
                card.className = 'feedback-card feedback-error';
                icon.className = 'fas fa-exclamation-circle text-danger';
                title.innerText = selectedIndex === -1 ? "Time's Up!" : "Not quite...";
                title.className = "mb-3 text-danger";
                msg.innerHTML = "Don't worry, learn from this:";
            }

            detail.innerHTML = `<strong>Feedback:</strong> ${currentQ.feedback}`;
        },

        nextQuestion() {
            document.getElementById('feedback-modal').classList.remove('active');
            this.currentIndex++;
            this.loadQuestion();
        },

        resumeFromPause() {
            document.getElementById('pause-modal').classList.remove('active');
            this.isPaused = false;
            this.loadQuestion();
        },

        updateUI() {
            document.getElementById('score-display').innerText = this.score;
        },

        endGame() {
            const container = document.getElementById('quiz-area');
            container.innerHTML = `
                <div class="question-card">
                    <h1 class="display-4 text-primary mb-4"><i class="fas fa-crown"></i> Quiz Complete!</h1>
                    <div class="display-1 mb-4">${this.score}</div>
                    <p class="lead text-muted">You've mastered these 10 questions.</p>
                    <button class="btn-action" onclick="gameLogic.init()">Play Again (New Questions) <i class="fas fa-redo ms-2"></i></button>
                </div>
            `;
            document.querySelector('.timer-bar').style.display = 'none';
        }
    };

    document.getElementById('next-btn').addEventListener('click', () => gameLogic.nextQuestion());

    const config = {
        type: Phaser.AUTO,
        parent: 'game-container',
        width: window.innerWidth,
        height: window.innerHeight,
        transparent: true,
        scale: { mode: Phaser.Scale.RESIZE },
        scene: BackgroundScene
    };

    const game = new Phaser.Game(config);
    gameLogic.init();

</script>
</body>
</html>